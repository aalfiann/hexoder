<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>How to Create App TotalJS with Mongoose 5 · Hexoder</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="How to Create App TotalJS with Mongoose 5 - M ABD AZIZ ALFIAN"><meta name="keywords" content="learning-javascript, tutorial-javascript, learning-nodejs, tutorial-nodejs"><meta name="author" content="M ABD AZIZ ALFIAN"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/aalfiann/hexoder@gh-pages/css/bubuzou.min.css"><link rel="search" type="application/opensearchdescription+xml" href="https://hexoder.com/atom.xml" title="Hexoder"><script src="//cdn.jsdelivr.net/npm/text-obfuscator@1.0.2/dist/text-obfuscator.min.js"></script><script>function parse_query_string(e){for(var o=e.replace("?","").split("&"),n={},r=0;r<o.length;r++){var t=o[r].split("="),i=decodeURIComponent(t[0]),a=decodeURIComponent(t[1]);if(void 0===n[i])n[i]=decodeURIComponent(a);else if("string"==typeof n[i]){var l=[n[i],decodeURIComponent(a)];n[i]=l}else n[i].push(decodeURIComponent(a))}return n}function removeParam(e,o){var n=o.split("?")[0],r=[],t=-1!==o.indexOf("?")?o.split("?")[1]:"";if(""!==t){for(var i=(r=t.split("&")).length-1;0<=i;i-=1)r[i].split("=")[0]===e&&r.splice(i,1);0<r.length?n=n+"?"+r.join("&"):n+=r.join("&")}return n}var hash=parse_query_string(window.location.search).to;if(hash){var link=TextObfuscator.decode(hash,3),newurl=removeParam("to",window.location.href);newurl=newurl.replace(window.location.origin,""),window.history.replaceState({},document.title,newurl)}</script><script data-ad-client="ca-pub-8811888720849913" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><header><div class="header row"><a class="logo-link" href="/"><img src="//cdn.jsdelivr.net/gh/aalfiann/hexoder@gh-pages/images/logo-landscape.png"></a><ul class="nav nav-list" id="nav_list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self" data-hover="HOME">HOME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/about" target="_self" data-hover="ABOUT">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self" data-hover="ARCHIVES">ARCHIVES</a></li><li class="nav-list-item"><a class="nav-list-link" href="/contact" target="_self" data-hover="CONTACT">CONTACT</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div><div class="nav-btn" id="nav_btn"><span></span><span></span><span></span></div></div></header><div class="row scroll-con"><section class="container"><div id="safelinker1"></div><div class="post" id="postAr"><article class="post-block"><h1 class="post-title">How to Create App TotalJS with Mongoose 5</h1><div class="post-info">2019-12-10</div><div class="post-content"><p><img src="https://i.imgur.com/PVr4g36.jpg" alt=""></p><p>Hello guys, today I will write an article about how to create an app totaljs with mongoose. What is mongoose? Mongoose is an Object Data Modeling (ODM) for MongoDB database.</p><p>Why I create this tutorial? Actualy TotalJS has created an example to use TotalJS with Mongoose at <a href="https://github.com/totaljs/examples/tree/master/mongoose" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">here</a>. But as you can see, it mongoose example has not been updated, it was too old as the last commit was 5 years ago. So in this article, I will using Mongoose 5, of course I have been research and make a test with latest MongoDB database version 4.2.0.</p><a id="more"></a><h2 id="Why-using-Mongoose"><a href="#Why-using-Mongoose" class="headerlink" title="Why using Mongoose?"></a>Why using Mongoose?</h2><p>There are several reasons why use Mongoose instead MongoDB driver directly.</p><ul><li>Schemas</li></ul><p>Actualy TotalJS has schema, Mongoose has too, but not for MongoDB. As you are know that MongoDB is schema-less, so sometimes for big project, we still need a schema so your code will be more readable and maintainable. TotalJS schema is can not to be use as data model for MongoDB, so with using Mongoose you are saving many hours to not create schema by yourself as mongoose has this schema feature.</p><ul><li>Validation</li></ul><p>Actualy TotalJS schema has data model validation. but TotalJS schema validation is can not to be use for relationship data model and to validate some spesific data types in MongoDB. Mongoose has this feature, means you have a second layer validation in your TotalJS schema.</p><ul><li>Instance Methods</li></ul><p>You can create a custom methods data hook and pre or post functionality on successful read / write operations in particular document. MongoDB driver has this too but mongoose is more easier.</p><ul><li>Auto Connection handler</li></ul><p>With using mongoose, you can easily create connection to MongoDB without have to <code>open()</code> or <code>close()</code> it manually. Mongoose has been handled this automatically as default.</p><p>Actualy there is still many reasons but I can’t describe all because we are not talk about this in detail. Maybe in another article I will write pros and cons of using Mongoose (I’m not promise this. lol).</p><h2 id="Reason-to-not-use-Mongoose"><a href="#Reason-to-not-use-Mongoose" class="headerlink" title="Reason to not use Mongoose"></a>Reason to not use Mongoose</h2><p>I can’t not answer this, because the reason to not use Mongoose is relative, everyone has their different answer also it is depend on your situations and conditions. But as for me, the reason to not use mongoose is:</p><ul><li>If you need the fastest perfomance.</li><li>You are working alone (not in a team).</li><li>Your project is small.</li><li>Your database is strict to use denormalize model.</li><li>etc</li></ul><p>If your condition is like above reasons, so you are better to use <code>MongoDB</code> instead <code>mongoose</code> library.</p><h2 id="TotalJS-with-Mongoose"><a href="#TotalJS-with-Mongoose" class="headerlink" title="TotalJS with Mongoose"></a>TotalJS with Mongoose</h2><p>So let’s start to create a TotalJS project with Mongoose 5.</p><p>The goal of this project is:</p><ul><li>Simple CRUD with latest Mongoose 5</li><li>Using TotalJS Schema and Mongoose Schema</li><li>Using MongoDB latest version 4.2.0</li><li>Json response is standardize between TotalJS and Mongoose response</li><li>Code must be clean, readable and maintainable</li></ul><h3 id="Directory-Structure"><a href="#Directory-Structure" class="headerlink" title="Directory Structure"></a>Directory Structure</h3><p>Before we are going to create the project, this is the directory structure plan for the project.</p><ul><li>controllers/<ul><li>default.js</li><li>user.js</li></ul></li><li>definitions/<ul><li>mongoose_conn.js</li><li>mongooose_schema.js</li></ul></li><li>models/<ul><li>user.js</li></ul></li><li>.gitignore</li><li>config</li><li>debug.js</li><li>package.json</li><li>postman.json</li><li>readme.md</li><li>release.js</li><li>test.js</li></ul><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>For the first time, we must generate a <code>package.json</code> with using this command</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm init</span><br></pre></td></tr></table></figure><p>Then I will install for <code>total.js</code> and <code>mongoose</code> library from NPM</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install total.js mongoose</span><br></pre></td></tr></table></figure><p>After install successfully, so here is the example of generated <code>package.json</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"totaljs-mongoose-rest-example"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"Example TotalJS with Mongoose 5 for create a simple CRUD Rest API"</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"debug.js"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"repository"</span>: &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"git"</span>,</span><br><span class="line">    <span class="string">"url"</span>: <span class="string">"git+https://github.com/aalfiann/totaljs-mongoose-rest-example.git"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"keywords"</span>: [</span><br><span class="line">    <span class="string">"totaljs"</span>,</span><br><span class="line">    <span class="string">"mongoose"</span>,</span><br><span class="line">    <span class="string">"rest-api"</span>,</span><br><span class="line">    <span class="string">"example"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"author"</span>: <span class="string">"M ABD AZIZ ALFIAN"</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"MIT"</span>,</span><br><span class="line">  <span class="string">"bugs"</span>: &#123;</span><br><span class="line">    <span class="string">"url"</span>: <span class="string">"https://github.com/aalfiann/totaljs-mongoose-rest-example/issues"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"homepage"</span>: <span class="string">"https://github.com/aalfiann/totaljs-mongoose-rest-example#readme"</span>,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"mongoose"</span>: <span class="string">"^5.7.1"</span>,</span><br><span class="line">    <span class="string">"total.js"</span>: <span class="string">"^3.2.4"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a>.gitignore</h3><p><code>.gitignore</code> file is required to prevent some files or directory to be uploaded into github repository.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">package-lock.json</span><br><span class="line">debug.pid</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure><h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><p><code>config</code> file is for default variables as configuration for application.</p><p>Here is the default <code>config</code> file</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">name                  : Total.js with Mongoose 5</span><br><span class="line">author                : M ABD AZIZ ALFIAN</span><br><span class="line">version               : 1.0.0</span><br><span class="line"></span><br><span class="line">// Mail settings</span><br><span class="line">mail_smtp             : smtp.yourwebsite.com</span><br><span class="line">mail_smtp_options     : &#123;&quot;secure&quot;:false,&quot;port&quot;:25,&quot;user&quot;:&quot;&quot;,&quot;password&quot;:&quot;&quot;,&quot;timeout&quot;:10000&#125;</span><br><span class="line">mail_address_from     : your@yourwebsite.com</span><br><span class="line">mail_address_reply    : your@yourwebsite.com</span><br><span class="line">mail_address_copy     :</span><br><span class="line"></span><br><span class="line">// MongoDB settings</span><br><span class="line">mongodb_url           : mongodb://127.0.0.1:27017/app</span><br><span class="line">mongodb_debug_event   : true</span><br></pre></td></tr></table></figure><h3 id="debug-js"><a href="#debug-js" class="headerlink" title="debug.js"></a>debug.js</h3><p>This <code>debug.js</code> file is the default from TotalJS documentation.</p><p>You can just copy and paste this</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ===================================================</span></span><br><span class="line"><span class="comment">// FOR DEVELOPMENT</span></span><br><span class="line"><span class="comment">// Total.js - framework for Node.js platform</span></span><br><span class="line"><span class="comment">// https://www.totaljs.com</span></span><br><span class="line"><span class="comment">// ===================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// options.ip = '127.0.0.1';</span></span><br><span class="line"><span class="comment">// options.port = parseInt(process.argv[2]);</span></span><br><span class="line"><span class="comment">// options.config = &#123; name: 'Total.js' &#125;;</span></span><br><span class="line"><span class="comment">// options.sleep = 3000;</span></span><br><span class="line"><span class="comment">// options.inspector = 9229;</span></span><br><span class="line"><span class="comment">// options.watch = ['private'];</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'total.js/debug'</span>)(options);</span><br></pre></td></tr></table></figure><h3 id="release-js"><a href="#release-js" class="headerlink" title="release.js"></a>release.js</h3><p>This <code>release.js</code> file is the default from TotalJS documentation.</p><p>You can just copy and paste this</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ===================================================</span></span><br><span class="line"><span class="comment">// FOR PRODUCTION</span></span><br><span class="line"><span class="comment">// Total.js - framework for Node.js platform</span></span><br><span class="line"><span class="comment">// https://www.totaljs.com</span></span><br><span class="line"><span class="comment">// ===================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// options.ip = '127.0.0.1';</span></span><br><span class="line"><span class="comment">// options.port = parseInt(process.argv[2]);</span></span><br><span class="line"><span class="comment">// options.config = &#123; name: 'Total.js' &#125;;</span></span><br><span class="line"><span class="comment">// options.sleep = 3000;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'total.js'</span>).http(<span class="string">'release'</span>, options);</span><br><span class="line"><span class="comment">// require('total.js').cluster.http(5, 'release', options);</span></span><br></pre></td></tr></table></figure><h3 id="test-js"><a href="#test-js" class="headerlink" title="test.js"></a>test.js</h3><p>This <code>test.js</code> file is the default from TotalJS documentation.</p><p>You can just copy and paste this</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ===================================================</span></span><br><span class="line"><span class="comment">// FOR UNIT-TESTING</span></span><br><span class="line"><span class="comment">// Total.js - framework for Node.js platform</span></span><br><span class="line"><span class="comment">// https://www.totaljs.com</span></span><br><span class="line"><span class="comment">// ===================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// options.ip = '127.0.0.1';</span></span><br><span class="line"><span class="comment">// options.port = parseInt(process.argv[2]);</span></span><br><span class="line"><span class="comment">// options.config = &#123; name: 'Total.js' &#125;;</span></span><br><span class="line"><span class="comment">// options.sleep = 3000;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'total.js'</span>).http(<span class="string">'test'</span>, options);</span><br></pre></td></tr></table></figure><h3 id="readme-md"><a href="#readme-md" class="headerlink" title="readme.md"></a>readme.md</h3><p>This <code>readme.md</code> file is just to show detail information about this project.</p><p>Here is the <code>readme.md</code> file</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># totaljs-mongoose-rest-example</span><br><span class="line">Example TotalJS with Mongoose 5 for create a simple CRUD Rest API</span><br><span class="line"></span><br><span class="line">- Download this example</span><br><span class="line">- run `$ npm install`</span><br><span class="line">- edit `config` file and change for `mongodb_url` value with yours.</span><br><span class="line">- run `$ node debug.js`</span><br><span class="line">- open browser `http://127.0.0.1:8000`</span><br><span class="line">- Import `postman.json` into your postman for test</span><br></pre></td></tr></table></figure><h3 id="postman-json"><a href="#postman-json" class="headerlink" title="postman.json"></a>postman.json</h3><p>This <code>postman.json</code> file is to make a test for all the request API.</p><p>You can just copy paste this <code>postman.json</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"info"</span>: &#123;</span><br><span class="line">		<span class="string">"_postman_id"</span>: <span class="string">"920f56c3-99ab-47f5-b204-330dcac4b15e"</span>,</span><br><span class="line">		<span class="string">"name"</span>: <span class="string">"Example Totaljs with Mongoose 5"</span>,</span><br><span class="line">		<span class="string">"schema"</span>: <span class="string">"https://schema.getpostman.com/json/collection/v2.1.0/collection.json"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">"item"</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">"name"</span>: <span class="string">"Add User"</span>,</span><br><span class="line">			<span class="string">"request"</span>: &#123;</span><br><span class="line">				<span class="string">"method"</span>: <span class="string">"POST"</span>,</span><br><span class="line">				<span class="string">"header"</span>: [</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">"key"</span>: <span class="string">"Content-Type"</span>,</span><br><span class="line">						<span class="string">"name"</span>: <span class="string">"Content-Type"</span>,</span><br><span class="line">						<span class="string">"value"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">						<span class="string">"type"</span>: <span class="string">"text"</span></span><br><span class="line">					&#125;</span><br><span class="line">				],</span><br><span class="line">				<span class="string">"body"</span>: &#123;</span><br><span class="line">					<span class="string">"mode"</span>: <span class="string">"raw"</span>,</span><br><span class="line">					<span class="string">"raw"</span>: <span class="string">"&#123;\n\t\"name\":\"john\",\n\t\"address\":\"yogyakarta\"\n&#125;"</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="string">"url"</span>: &#123;</span><br><span class="line">					<span class="string">"raw"</span>: <span class="string">"http://127.0.0.1:8000/api/user/add"</span>,</span><br><span class="line">					<span class="string">"protocol"</span>: <span class="string">"http"</span>,</span><br><span class="line">					<span class="string">"host"</span>: [</span><br><span class="line">						<span class="string">"127"</span>,</span><br><span class="line">						<span class="string">"0"</span>,</span><br><span class="line">						<span class="string">"0"</span>,</span><br><span class="line">						<span class="string">"1"</span></span><br><span class="line">					],</span><br><span class="line">					<span class="string">"port"</span>: <span class="string">"8000"</span>,</span><br><span class="line">					<span class="string">"path"</span>: [</span><br><span class="line">						<span class="string">"api"</span>,</span><br><span class="line">						<span class="string">"user"</span>,</span><br><span class="line">						<span class="string">"add"</span></span><br><span class="line">					]</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">"response"</span>: []</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">"name"</span>: <span class="string">"List User"</span>,</span><br><span class="line">			<span class="string">"request"</span>: &#123;</span><br><span class="line">				<span class="string">"method"</span>: <span class="string">"GET"</span>,</span><br><span class="line">				<span class="string">"header"</span>: [],</span><br><span class="line">				<span class="string">"url"</span>: &#123;</span><br><span class="line">					<span class="string">"raw"</span>: <span class="string">"http://127.0.0.1:8000/api/user/list"</span>,</span><br><span class="line">					<span class="string">"protocol"</span>: <span class="string">"http"</span>,</span><br><span class="line">					<span class="string">"host"</span>: [</span><br><span class="line">						<span class="string">"127"</span>,</span><br><span class="line">						<span class="string">"0"</span>,</span><br><span class="line">						<span class="string">"0"</span>,</span><br><span class="line">						<span class="string">"1"</span></span><br><span class="line">					],</span><br><span class="line">					<span class="string">"port"</span>: <span class="string">"8000"</span>,</span><br><span class="line">					<span class="string">"path"</span>: [</span><br><span class="line">						<span class="string">"api"</span>,</span><br><span class="line">						<span class="string">"user"</span>,</span><br><span class="line">						<span class="string">"list"</span></span><br><span class="line">					]</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">"response"</span>: []</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">"name"</span>: <span class="string">"Search User"</span>,</span><br><span class="line">			<span class="string">"request"</span>: &#123;</span><br><span class="line">				<span class="string">"method"</span>: <span class="string">"GET"</span>,</span><br><span class="line">				<span class="string">"header"</span>: [],</span><br><span class="line">				<span class="string">"url"</span>: &#123;</span><br><span class="line">					<span class="string">"raw"</span>: <span class="string">"http://127.0.0.1:8000/api/user?search="</span>,</span><br><span class="line">					<span class="string">"protocol"</span>: <span class="string">"http"</span>,</span><br><span class="line">					<span class="string">"host"</span>: [</span><br><span class="line">						<span class="string">"127"</span>,</span><br><span class="line">						<span class="string">"0"</span>,</span><br><span class="line">						<span class="string">"0"</span>,</span><br><span class="line">						<span class="string">"1"</span></span><br><span class="line">					],</span><br><span class="line">					<span class="string">"port"</span>: <span class="string">"8000"</span>,</span><br><span class="line">					<span class="string">"path"</span>: [</span><br><span class="line">						<span class="string">"api"</span>,</span><br><span class="line">						<span class="string">"user"</span></span><br><span class="line">					],</span><br><span class="line">					<span class="string">"query"</span>: [</span><br><span class="line">						&#123;</span><br><span class="line">							<span class="string">"key"</span>: <span class="string">"search"</span>,</span><br><span class="line">							<span class="string">"value"</span>: <span class="string">""</span></span><br><span class="line">						&#125;</span><br><span class="line">					]</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">"response"</span>: []</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">"name"</span>: <span class="string">"Update User"</span>,</span><br><span class="line">			<span class="string">"request"</span>: &#123;</span><br><span class="line">				<span class="string">"method"</span>: <span class="string">"PUT"</span>,</span><br><span class="line">				<span class="string">"header"</span>: [</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">"key"</span>: <span class="string">"Content-Type"</span>,</span><br><span class="line">						<span class="string">"name"</span>: <span class="string">"Content-Type"</span>,</span><br><span class="line">						<span class="string">"value"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">						<span class="string">"type"</span>: <span class="string">"text"</span></span><br><span class="line">					&#125;</span><br><span class="line">				],</span><br><span class="line">				<span class="string">"body"</span>: &#123;</span><br><span class="line">					<span class="string">"mode"</span>: <span class="string">"raw"</span>,</span><br><span class="line">					<span class="string">"raw"</span>: <span class="string">"&#123;\n\t\"id\":\"5d88ad7da18ff47df554eb77\",\n\t\"name\":\"john\",\n\t\"address\":\"indonesia\"\n&#125;"</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="string">"url"</span>: &#123;</span><br><span class="line">					<span class="string">"raw"</span>: <span class="string">"http://127.0.0.1:8000/api/user/update"</span>,</span><br><span class="line">					<span class="string">"protocol"</span>: <span class="string">"http"</span>,</span><br><span class="line">					<span class="string">"host"</span>: [</span><br><span class="line">						<span class="string">"127"</span>,</span><br><span class="line">						<span class="string">"0"</span>,</span><br><span class="line">						<span class="string">"0"</span>,</span><br><span class="line">						<span class="string">"1"</span></span><br><span class="line">					],</span><br><span class="line">					<span class="string">"port"</span>: <span class="string">"8000"</span>,</span><br><span class="line">					<span class="string">"path"</span>: [</span><br><span class="line">						<span class="string">"api"</span>,</span><br><span class="line">						<span class="string">"user"</span>,</span><br><span class="line">						<span class="string">"update"</span></span><br><span class="line">					]</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">"response"</span>: []</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">"name"</span>: <span class="string">"Delete User"</span>,</span><br><span class="line">			<span class="string">"request"</span>: &#123;</span><br><span class="line">				<span class="string">"method"</span>: <span class="string">"DELETE"</span>,</span><br><span class="line">				<span class="string">"header"</span>: [],</span><br><span class="line">				<span class="string">"url"</span>: &#123;</span><br><span class="line">					<span class="string">"raw"</span>: <span class="string">"http://127.0.0.1:8000/api/user/delete/&#123;id&#125;"</span>,</span><br><span class="line">					<span class="string">"protocol"</span>: <span class="string">"http"</span>,</span><br><span class="line">					<span class="string">"host"</span>: [</span><br><span class="line">						<span class="string">"127"</span>,</span><br><span class="line">						<span class="string">"0"</span>,</span><br><span class="line">						<span class="string">"0"</span>,</span><br><span class="line">						<span class="string">"1"</span></span><br><span class="line">					],</span><br><span class="line">					<span class="string">"port"</span>: <span class="string">"8000"</span>,</span><br><span class="line">					<span class="string">"path"</span>: [</span><br><span class="line">						<span class="string">"api"</span>,</span><br><span class="line">						<span class="string">"user"</span>,</span><br><span class="line">						<span class="string">"delete"</span>,</span><br><span class="line">						<span class="string">"&#123;id&#125;"</span></span><br><span class="line">					]</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">"response"</span>: []</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="definitions-mongoose-conn-js"><a href="#definitions-mongoose-conn-js" class="headerlink" title="definitions/mongoose_conn.js"></a>definitions/mongoose_conn.js</h3><p>Now we will create a connection from Mongoose to MongoDB database.</p><p>You can just copy and paste this <code>mongoose_conn.js</code> file</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * You don't have to require this into your other file .js anymore </span></span><br><span class="line"><span class="comment"> * because mongoose connection will open once then </span></span><br><span class="line"><span class="comment"> * reuse the connection automatically</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>( <span class="string">'mongoose'</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Mongoose starting connection</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">mongoose.connect(F.config.mongodb_url, &#123;</span><br><span class="line">    autoReconnect: <span class="literal">true</span>,</span><br><span class="line">    useNewUrlParser: <span class="literal">true</span>,</span><br><span class="line">    useUnifiedTopology: <span class="literal">true</span>,</span><br><span class="line">    useCreateIndex: <span class="literal">true</span>,</span><br><span class="line">    useFindAndModify: <span class="literal">false</span>,</span><br><span class="line">    reconnectTries: <span class="built_in">Number</span>.MAX_SAFE_INTEGER</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// CONNECTION EVENTS</span></span><br><span class="line"><span class="keyword">if</span>(F.config.mongodb_debug_event) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Mongoose start making connection to MongoDB</span></span><br><span class="line">    mongoose.connection.on(<span class="string">'connected'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().format(<span class="string">'yyyy-MM-dd HH:mm:ss'</span>)+<span class="string">' : '</span>+<span class="string">'Mongoose start making connection to '</span> + F.config.mongodb_url);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When successfully connected</span></span><br><span class="line">    mongoose.connection.on(<span class="string">'connected'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().format(<span class="string">'yyyy-MM-dd HH:mm:ss'</span>)+<span class="string">' : '</span>+<span class="string">'Mongoose successfully connected with MongoDB'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When connection lost mongoose will try to reconnect and the reconnect connection is successful connected</span></span><br><span class="line">    mongoose.connection.on(<span class="string">'reconnected'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().format(<span class="string">'yyyy-MM-dd HH:mm:ss'</span>)+<span class="string">' : '</span>+<span class="string">'Mongoose successfully reconnected with MongoDB'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the connection throws an error</span></span><br><span class="line">    mongoose.connection.on(<span class="string">'error'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;  </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().format(<span class="string">'yyyy-MM-dd HH:mm:ss'</span>)+<span class="string">' : '</span>+<span class="string">'Mongoose connection error: '</span> + err);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Mongoose start disconnecting from MongoDB</span></span><br><span class="line">    mongoose.connection.on(<span class="string">'disconnecting'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().format(<span class="string">'yyyy-MM-dd HH:mm:ss'</span>)+<span class="string">' : '</span>+<span class="string">'Disconnecting Mongoose from MongoDB'</span>); </span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When the connection is already disconnected</span></span><br><span class="line">    mongoose.connection.on(<span class="string">'disconnected'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().format(<span class="string">'yyyy-MM-dd HH:mm:ss'</span>)+<span class="string">' : '</span>+<span class="string">'Mongoose is already disconnected from MongoDB'</span>); </span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the Node process ends, close the Mongoose connection </span></span><br><span class="line">    process.on(<span class="string">'SIGINT'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        mongoose.connection.close();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Note:</p><ul><li>You don’t have to require this <code>mongoose_conn.js</code>, because this library will be called inside <code>mongoose_schema.js</code>.</li></ul><h3 id="mongoose-schema-js"><a href="#mongoose-schema-js" class="headerlink" title="mongoose_schema.js"></a>mongoose_schema.js</h3><p>Now we will create a <code>mongoose_schema.js</code> file, this library will work as helper for creating a TotalJS schema.</p><p>You can just copy and paste this <code>mongoose_schema.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="keyword">const</span> mongooseSchema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Transform document object</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; doc </span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; ret </span></span><br><span class="line"><span class="comment"> * @return &#123;object&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transform</span>(<span class="params">doc, ret</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">delete</span> ret._id;</span><br><span class="line">    ret.id = doc._id.toString();</span><br><span class="line">    <span class="keyword">return</span> ret;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create Mongoose schema</span></span><br><span class="line"><span class="comment"> * @param &#123;object&#125; obj</span></span><br><span class="line"><span class="comment"> * @return &#123;schema&#125; </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createSchema</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> schema = <span class="keyword">new</span> mongooseSchema(obj, &#123;</span><br><span class="line">        toObject: &#123; transform &#125;,</span><br><span class="line">        toJSON: &#123; transform &#125;  </span><br><span class="line">    &#125;);</span><br><span class="line">      </span><br><span class="line">    schema.set(<span class="string">'toObject'</span>, &#123;<span class="attr">virtuals</span>:<span class="literal">true</span>&#125;);</span><br><span class="line">    <span class="keyword">return</span> schema;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Set Mongoose model</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; name </span></span><br><span class="line"><span class="comment"> * @param &#123;object&#125; schema</span></span><br><span class="line"><span class="comment"> * @return &#123;model&#125; </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setModel</span>(<span class="params">name,schema</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mongoose.model(name, createSchema(schema));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Modify error from totaljs schema</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; name     this is the error key name </span></span><br><span class="line"><span class="comment"> * @return &#123;ErrorBuilder&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">schemaErrorBuilder</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ErrorBuilder.addTransform(name, <span class="function"><span class="keyword">function</span>(<span class="params">isResponse</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> builder = [];</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, length = <span class="keyword">this</span>.items.length; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> err = <span class="keyword">this</span>.items[i];</span><br><span class="line">            builder.push(&#123;<span class="attr">name</span>:err.name,<span class="attr">error</span>:err.error&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (isResponse) &#123;</span><br><span class="line">            <span class="keyword">if</span> (builder.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">this</span>.status = <span class="number">400</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">                    code:<span class="keyword">this</span>.status,</span><br><span class="line">                    status:<span class="string">'error'</span>,</span><br><span class="line">                    message:<span class="string">'Invalid parameter'</span>,</span><br><span class="line">                    error:builder</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.status = <span class="number">500</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">                    code:<span class="keyword">this</span>.status,</span><br><span class="line">                    status:<span class="string">'error'</span>,</span><br><span class="line">                    message:<span class="string">'Something went wrong...'</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Response error in Mongoose</span></span><br><span class="line"><span class="comment"> * @param &#123;controller&#125; $        this is the totaljs controller</span></span><br><span class="line"><span class="comment"> * @param &#123;object&#125; err          this is the error detail from Mongoose</span></span><br><span class="line"><span class="comment"> * @return &#123;callback&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">errorHandler</span>(<span class="params">$, err</span>)</span>&#123;</span><br><span class="line">    $.controller.status = <span class="number">400</span>;</span><br><span class="line">    <span class="keyword">var</span> error = &#123;</span><br><span class="line">        code:err.code,</span><br><span class="line">        status:<span class="string">'error'</span>,</span><br><span class="line">        message:err.errmsg,</span><br><span class="line">        error:&#123;</span><br><span class="line">            driver:err.driver,</span><br><span class="line">            name:err.name,</span><br><span class="line">            index:err.index,</span><br><span class="line">            keyPattern:err.keyPattern,</span><br><span class="line">            keyValue:err.keyValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $.callback(<span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(error)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Response success </span></span><br><span class="line"><span class="comment"> * @param &#123;controller&#125; $        this is the totaljs controller</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; message      this is the message of response</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; response          this is the response detail</span></span><br><span class="line"><span class="comment"> * @return &#123;callback&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">successResponse</span> (<span class="params">$,message, response=[]</span>) </span>&#123;</span><br><span class="line">    $.controller.status = <span class="number">200</span>;</span><br><span class="line">    <span class="keyword">var</span> success = &#123;</span><br><span class="line">        <span class="string">'code'</span>:<span class="number">200</span>,</span><br><span class="line">        <span class="string">'status'</span>:<span class="string">'success'</span>,</span><br><span class="line">        <span class="string">'message'</span>:message,</span><br><span class="line">        <span class="string">'response'</span>:response</span><br><span class="line">    &#125;</span><br><span class="line">    $.callback(<span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(success)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Response fail </span></span><br><span class="line"><span class="comment"> * @param &#123;controller&#125; $        this is the totaljs controller</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; message      this is the message of response</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; response          this is the response detail</span></span><br><span class="line"><span class="comment"> * @return &#123;callback&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">failResponse</span> (<span class="params">$, message, response=[]</span>) </span>&#123;</span><br><span class="line">    $.controller.status = <span class="number">200</span>;</span><br><span class="line">    <span class="keyword">var</span> fail = &#123;</span><br><span class="line">        <span class="string">'code'</span>:<span class="number">200</span>,</span><br><span class="line">        <span class="string">'status'</span>:<span class="string">'error'</span>,</span><br><span class="line">        <span class="string">'message'</span>:message,</span><br><span class="line">        <span class="string">'response'</span>:response</span><br><span class="line">    &#125;</span><br><span class="line">    $.callback(<span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(fail)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Response custom </span></span><br><span class="line"><span class="comment"> * @param &#123;controller&#125; $        this is the totaljs controller</span></span><br><span class="line"><span class="comment"> * @param &#123;int&#125; code            this is the http code you want to sent in response header</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; status       this is the status you want to sent in response body</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; message      this is the message of response</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; response          this is the response detail</span></span><br><span class="line"><span class="comment"> * @param &#123;bool&#125; isError        this is the type of success or error response</span></span><br><span class="line"><span class="comment"> * @return &#123;callback&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">customResponse</span> (<span class="params">$, code, status, message, response=[], isError=false</span>) </span>&#123;</span><br><span class="line">    $.controller.status = code;</span><br><span class="line">    <span class="keyword">var</span> custom = &#123;</span><br><span class="line">        <span class="string">'code'</span>:code,</span><br><span class="line">        <span class="string">'status'</span>:status,</span><br><span class="line">        <span class="string">'message'</span>:message</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(response !== <span class="literal">undefined</span> &amp;&amp; response !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> name = <span class="literal">undefined</span>;</span><br><span class="line">        <span class="keyword">if</span>(isError) &#123;</span><br><span class="line">            name = <span class="string">'error'</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            name = <span class="string">'response'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        custom[name] = response;</span><br><span class="line">    &#125;</span><br><span class="line">    $.callback(<span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(custom)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    createSchema,</span><br><span class="line">    setModel,</span><br><span class="line">    schemaErrorBuilder,</span><br><span class="line">    errorHandler,</span><br><span class="line">    successResponse,</span><br><span class="line">    failResponse,</span><br><span class="line">    customResponse</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="models-user-js"><a href="#models-user-js" class="headerlink" title="models/user.js"></a>models/user.js</h3><p>Now we will create <code>user.js</code> file inside models directory.</p><p>You can just copy and paste this <code>user.js</code> file</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">NEWSCHEMA(<span class="string">'User'</span>).make(<span class="function"><span class="keyword">function</span>(<span class="params">schema</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Better to use var instead const</span></span><br><span class="line">    <span class="keyword">var</span> mongoose = <span class="built_in">require</span>(F.path.definitions(<span class="string">'mongoose_schema'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Schema for Mongoose</span></span><br><span class="line">    <span class="keyword">var</span> userSchema = &#123;</span><br><span class="line">        name: &#123;</span><br><span class="line">          type: <span class="built_in">String</span>,</span><br><span class="line">          required: [<span class="literal">true</span>, <span class="string">"A name is required"</span>],</span><br><span class="line">          trim: <span class="literal">true</span>,</span><br><span class="line">          max: [<span class="number">40</span>, <span class="string">'The maximum name length is 40'</span>],</span><br><span class="line">          unique: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        address: &#123;</span><br><span class="line">            type: <span class="built_in">String</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Define User model</span></span><br><span class="line">    <span class="keyword">var</span> User = mongoose.setModel(<span class="string">'User'</span>,userSchema);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Define interface schema</span></span><br><span class="line">    schema.define(<span class="string">'id'</span>, <span class="string">'string'</span>);</span><br><span class="line">    schema.define(<span class="string">'name'</span>, <span class="string">'string'</span>, <span class="literal">true</span>);</span><br><span class="line">    schema.define(<span class="string">'address'</span>, <span class="string">'string'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Listen schema validation error from totaljs</span></span><br><span class="line">    mongoose.schemaErrorBuilder(<span class="string">'custom'</span>);</span><br><span class="line">    schema.setError(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123; error.setTransform(<span class="string">'custom'</span>) &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// List User</span></span><br><span class="line">    schema.addWorkflow(<span class="string">'list'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">        User.find().then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">            mongoose.successResponse($,<span class="string">'Data found'</span>,response);</span><br><span class="line">        &#125;, (err) =&gt; &#123;</span><br><span class="line">            mongoose.errorBuilder($,err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add User</span></span><br><span class="line">    schema.addWorkflow(<span class="string">'add'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> body = $.model.$clean();</span><br><span class="line">        <span class="keyword">new</span> User(body).save().then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">            mongoose.successResponse($,<span class="string">'Add user successful'</span>,response);</span><br><span class="line">        &#125;, (err) =&gt; &#123;</span><br><span class="line">            mongoose.errorHandler($,err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Search User</span></span><br><span class="line">    schema.addWorkflow(<span class="string">'search'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> query = $.query;</span><br><span class="line">        User.find(&#123;</span><br><span class="line">            $or:[</span><br><span class="line">                &#123;<span class="attr">name</span>:&#123;<span class="attr">$regex</span>: query.search&#125;&#125;,</span><br><span class="line">                &#123;<span class="attr">address</span>:&#123;<span class="attr">$regex</span>: query.search&#125;&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">            mongoose.successResponse($,<span class="string">'Data found'</span>,response);</span><br><span class="line">        &#125;,(err) =&gt; &#123;</span><br><span class="line">            mongoose.errorHandler($,err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update User</span></span><br><span class="line">    schema.addWorkflow(<span class="string">'update'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> body = $.model.$clean();</span><br><span class="line">        User.findOneAndUpdate(&#123;</span><br><span class="line">            _id:body.id</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            name:body.name,</span><br><span class="line">            address:body.address</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            <span class="keyword">new</span>:<span class="literal">true</span></span><br><span class="line">        &#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">            mongoose.successResponse($,<span class="string">'Update data is succesful'</span>,response);</span><br><span class="line">        &#125;,(err) =&gt; &#123;</span><br><span class="line">            mongoose.errorHandler($,err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Delete User</span></span><br><span class="line">    schema.addWorkflow(<span class="string">'delete'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">        User.deleteOne(&#123;</span><br><span class="line">            _id:$.id</span><br><span class="line">        &#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">            mongoose.successResponse($,<span class="string">'Delete data is succesful'</span>,response);</span><br><span class="line">        &#125;,(err) =&gt; &#123;</span><br><span class="line">            mongoose.errorHandler($,err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>As you can see on above code, We are using two schemas, it is TotalJS schema and Mongoose schema. So we have two layer validation for the data model.</p><h3 id="controllers-default-js"><a href="#controllers-default-js" class="headerlink" title="controllers/default.js"></a>controllers/default.js</h3><p>I will create default controller to show your visitor about your API website.</p><p>You can just copy and paste this <code>default.js</code> file</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">exports.install = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	ROUTE(<span class="string">'/'</span>, view_plain);</span><br><span class="line">	</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">view_plain</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">	self.plain(F.config.name+<span class="string">'\n'</span>+<span class="string">'Version : '</span>+F.config.version+<span class="string">'\n'</span>+<span class="string">'Author : '</span>+F.config.author);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="controllers-user-js"><a href="#controllers-user-js" class="headerlink" title="controllers/user.js"></a>controllers/user.js</h3><p>Now we will create the controller and routes for api <code>user.js</code>.</p><p>You can just copy and paste this <code>user.js</code> file</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">exports.install = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Allow Cors</span></span><br><span class="line">  CORS(<span class="string">'/api/*'</span>, [<span class="string">'get'</span>, <span class="string">'post'</span>, <span class="string">'put'</span>, <span class="string">'delete'</span>], <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set Route</span></span><br><span class="line">  ROUTE(<span class="string">'/api/user'</span>, [<span class="string">'get'</span>,<span class="string">'post'</span>,<span class="string">'*User --&gt; @search'</span>]);</span><br><span class="line">  ROUTE(<span class="string">'/api/user/list'</span>, [<span class="string">'get'</span>,<span class="string">'post'</span>,<span class="string">'*User --&gt; @list'</span>]);</span><br><span class="line">  ROUTE(<span class="string">'/api/user/add'</span>, [<span class="string">'post'</span>,<span class="string">'*User --&gt; @add'</span>]);</span><br><span class="line">  ROUTE(<span class="string">'/api/user/update'</span>, [<span class="string">'put'</span>,<span class="string">'*User --&gt; @update'</span>]);</span><br><span class="line">  ROUTE(<span class="string">'/api/user/delete/&#123;id&#125;'</span>, [<span class="string">'delete'</span>,<span class="string">'*User --&gt; @delete'</span>]);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h3><p>Now we have already simple Rest API with Mongoose 5. You can read the <code>readme.md</code> file for using this project.</p><p>But if you are following the step by step of this article, to use this project is</p><ul><li><p>run the server by this command</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node debug.js</span><br></pre></td></tr></table></figure></li><li><p>now open the browser <code>http://127.0.0.1:8000</code></p></li><li><p>if successfully, now open your postman app</p></li><li><p>Import the <code>postman.json</code> into your postman app</p></li><li><p>Now you can make a request to test your API from postman app</p></li></ul><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>MongoDB version 4.2.0 is the latest MongoDB database and Mongoose 5 is the latest mongoose version for today as I write this article. I have tested this project and everything is running well with no any problems.</p><p>This project is just an example to create a Simple CRUD API TotalJS with Mongoose 5. Actualy this project has been uploaded into my github repository, You can just download the whole source code at <a href="https://github.com/aalfiann/totaljs-mongoose-rest-example" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">here</a>.</p><p>I don’t make explanation in very detail because the code is very simple and I’m sure this is not too hard for newbie to learning this source code. But if there is something that you don’t understand, just feel free to leave comment at below.</p><p>Thank You for your time to reading this article.</p></div></article></div><div id="safelinker2"></div><div class="right-container"><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">Search</label></div><div class="search-result" id="search_result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a class="prev" href="/post/reason-why-i-choose-elementary-os/" title="Reason Why I Choose Elementary OS">PREV</a><a class="next" href="/post/best-practice-to-create-rest-api-with-totaljs-framework/" title="Best Practice to Create Rest API With TotalJS Framework">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url=window.location.href,this.page.identifier=window.location.href};!function(){var e=document,t=e.createElement("script");t.src="https://hexoder.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script><div class="copyright"><p>© 2019 - 2020 <a href="/" target="_blank">Hexoder</a> | <a href="/disclaimer">Disclaimer</a> | <a href="/privacy-policy">Privacy</a> | <a href="/atom.xml">Feed</a> | <a href="/sitemap.xml">Sitemap</a></p><br><a class="dmca-badge" href="//www.dmca.com/Protection/Status.aspx?ID=eb23d7cc-74cc-4a2f-8e4d-d4676a061313" title="DMCA.com Protection Status"><img src="https://images.dmca.com/Badges/dmca_protected_sml_120m.png?ID=eb23d7cc-74cc-4a2f-8e4d-d4676a061313" alt="DMCA.com Protection Status"></a><script src="https://images.dmca.com/Badges/DMCABadgeHelper.min.js"></script></div><div class="totop"><i></i></div></div></footer><script src="//cdn.jsdelivr.net/gh/aalfiann/hexoder@gh-pages/scripts/jquery-1.8.2.min.js"></script><script src="//cdn.jsdelivr.net/gh/aalfiann/hexoder@gh-pages/scripts/ar-anchor.min.js"></script><script src="//cdn.jsdelivr.net/gh/aalfiann/hexoder@gh-pages/scripts/main.js"></script><script src="//cdn.jsdelivr.net/npm/safelink-jquery@1.1.0/src/safelink.min.js"></script><script>$("#safelinker1").Safelink({encoded:link,timer:!0,firstButtonText:"Click Here First >>",secondButtonText:"Continue to Get Link >>"}).build("#safelinker2","btn-safelink btn-hoverable")</script><script>!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga||(e.ga=function(){(e.ga.q=e.ga.q||[]).push(arguments)}),e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-151912342-1","auto"),ga("send","pageview")</script></body></html>