<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Right Way to Deep Clone Object JavaScript · Hexoder</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Right Way to Deep Clone Object JavaScript - M ABD AZIZ ALFIAN"><meta name="keywords" content="learning-javascript, tutorial-javascript, learning-nodejs, tutorial-nodejs"><meta name="author" content="M ABD AZIZ ALFIAN"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.min.css"><link rel="search" type="application/opensearchdescription+xml" href="https://hexoder.com/atom.xml" title="Hexoder"><meta name="generator" content="Hexo 4.0.0"></head><body><header><div class="header row"> <a class="logo-link" href="/"><img src="/images/logo.png"></a><ul class="nav nav-list" id="nav_list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self" data-hover="HOME">HOME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self" data-hover="ARCHIVES">ARCHIVES</a></li><li class="nav-list-item"><a class="nav-list-link" href="/post/contact" target="_self" data-hover="CONTACT">CONTACT</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div><div class="nav-btn" id="nav_btn"><span></span><span></span><span></span></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div class="post" id="postAr"><article class="post-block"><h1 class="post-title">Right Way to Deep Clone Object JavaScript</h1><div class="post-info">2019-11-10</div><div class="post-content"><p>Deep clone an object array in JavaScript is not simple. Because it still brings the reference of previous object. This could lead a problem in your application. So in this topic, I will divide into two ways:</p>
<a id="more"></a>

<h2 id="Bad-Practice"><a href="#Bad-Practice" class="headerlink" title="Bad Practice"></a>Bad Practice</h2><p>The most best answer in <code>Stackoverflow</code>, to deep clone an object javascript is just like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify());</span><br></pre></td></tr></table></figure>

<h3 id="Then-why-this-is-bad-practice"><a href="#Then-why-this-is-bad-practice" class="headerlink" title="Then why this is bad practice?"></a>Then why this is bad practice?</h3><h3 id="Convertion-Problem"><a href="#Convertion-Problem" class="headerlink" title="Convertion Problem"></a>Convertion Problem</h3><p>The problem is <code>JSON.stringify()</code> cloud lead into wrong convertion. Because it just convert the javascript <code>Object</code> into <code>String</code>. You can not control for spesific instance inside the object.</p>
<p>Example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(&#123; <span class="attr">key</span>: <span class="literal">undefined</span> &#125;);</span><br><span class="line"><span class="built_in">JSON</span>.stringify(&#123; <span class="attr">key</span>: <span class="built_in">Symbol</span>() &#125;);</span><br><span class="line"><span class="built_in">JSON</span>.stringify(&#123; <span class="attr">key</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; &#125;);</span><br><span class="line"><span class="comment">// all will be converted to just "&#123;&#125;"</span></span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong></p>
<ul>
<li><code>Date()</code> will also parsed to string, so you will lose it.</li>
</ul>
<h3 id="Not-Eficient-very-slow"><a href="#Not-Eficient-very-slow" class="headerlink" title="Not Eficient (very slow)"></a>Not Eficient (very slow)</h3><p>I have test to deep clone 1 million object and this take higher than 1 seconds (<code>1823ms</code>). This will freeze your application since this way is blocking (synchronous). You have to be more tricky to avoid this blocking for handle big object.</p>
<h2 id="Good-Practice"><a href="#Good-Practice" class="headerlink" title="Good Practice"></a>Good Practice</h2><p>We should go back to use primitive way by using <code>loop</code> and <code>recursion</code>.</p>
<p>Example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> clone, i;</span><br><span class="line">  <span class="comment">// if parameter is not array or object then just return it so you will not lose spesific instance.</span></span><br><span class="line">  <span class="comment">// ex. Date(), Symbol(), function(), etc.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> array !== <span class="string">'object'</span> || !array) <span class="keyword">return</span> array;</span><br><span class="line">  <span class="comment">// if object is array then convert this to string</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'[object Array]'</span> === <span class="built_in">Object</span>.prototype.toString.apply(array)) &#123;</span><br><span class="line">    clone = [];</span><br><span class="line">    <span class="keyword">var</span> len = array.length;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) clone[i] = deepClone(array[i]);</span><br><span class="line">    <span class="keyword">return</span> clone;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// handle object (skip if doesn't have property)</span></span><br><span class="line">  clone = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> array) <span class="keyword">if</span> (array.hasOwnProperty(i)) clone[i] = deepClone(array[i]);</span><br><span class="line">  <span class="keyword">return</span> clone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Then-why-this-is-good-practice"><a href="#Then-why-this-is-good-practice" class="headerlink" title="Then why this is good practice?"></a>Then why this is good practice?</h3><h3 id="Easy-to-modify"><a href="#Easy-to-modify" class="headerlink" title="Easy to modify"></a>Easy to modify</h3><p>Because using loop you can put any condition inside the logic.</p>
<h3 id="5x-faster"><a href="#5x-faster" class="headerlink" title="5x faster"></a>5x faster</h3><p>This is 5x faster comparing with <code>JSON.parse(JSON.stringify())</code>. I have test this with 1 million object and it just takes <code>150ms</code>.</p>
<h2 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a>Benchmark</h2><p>Before I write this topic, I have research carefully about deepClone, especially for the performance in NodeJS.</p>
<h3 id="json-parse-stringify-js"><a href="#json-parse-stringify-js" class="headerlink" title="json-parse-stringify.js"></a>json-parse-stringify.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [];</span><br><span class="line"><span class="keyword">var</span> clone = [];</span><br><span class="line"><span class="keyword">var</span> start = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> end = <span class="number">1000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().toISOString().replace(<span class="string">'T'</span>,<span class="string">' '</span>).replace(<span class="string">'Z'</span>,<span class="string">''</span>).substr(<span class="number">0</span>,<span class="number">19</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Build '</span>+end+<span class="string">' object'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildObject</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i =start;i&lt;=end;i++) &#123;</span><br><span class="line">            array.push(&#123; <span class="attr">id</span>:i, <span class="attr">name</span>:<span class="string">'user_'</span>+i &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        resolve();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">buildObject().then(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().toISOString().replace(<span class="string">'T'</span>,<span class="string">' '</span>).replace(<span class="string">'Z'</span>,<span class="string">''</span>).substr(<span class="number">0</span>,<span class="number">19</span>));</span><br><span class="line">    <span class="built_in">console</span>.log(array.length+<span class="string">' object has been build'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'======'</span>);</span><br><span class="line">    <span class="keyword">return</span> resolve;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Start clone '</span>+array.length+<span class="string">' object: '</span>+<span class="keyword">new</span> <span class="built_in">Date</span>().toISOString().replace(<span class="string">'T'</span>,<span class="string">' '</span>).replace(<span class="string">'Z'</span>,<span class="string">''</span>).substr(<span class="number">0</span>,<span class="number">19</span>));</span><br><span class="line">    <span class="keyword">var</span> time_start = <span class="built_in">Date</span>.now();</span><br><span class="line">    clone = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(array));</span><br><span class="line">    <span class="keyword">var</span> time_end = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Finish clone '</span>+array.length+<span class="string">' object: '</span>+<span class="keyword">new</span> <span class="built_in">Date</span>().toISOString().replace(<span class="string">'T'</span>,<span class="string">' '</span>).replace(<span class="string">'Z'</span>,<span class="string">''</span>).substr(<span class="number">0</span>,<span class="number">19</span>));</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Total execution time: '</span>+ (time_end-time_start)+<span class="string">'ms'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'======'</span>);</span><br><span class="line">    <span class="keyword">return</span> resolve;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="loop-recursive-js"><a href="#loop-recursive-js" class="headerlink" title="loop-recursive.js"></a>loop-recursive.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [];</span><br><span class="line"><span class="keyword">var</span> clone = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> start = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> end = <span class="number">1000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().toISOString().replace(<span class="string">'T'</span>,<span class="string">' '</span>).replace(<span class="string">'Z'</span>,<span class="string">''</span>).substr(<span class="number">0</span>,<span class="number">19</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Build '</span>+end+<span class="string">' object'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildObject</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i =start;i&lt;=end;i++) &#123;</span><br><span class="line">            array.push(&#123; <span class="attr">id</span>:i, <span class="attr">name</span>:<span class="string">'user_'</span>+i &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        resolve();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> clone, i;</span><br><span class="line">    <span class="comment">// if parameter is not array or object then just return it so you will not lose spesific instance.</span></span><br><span class="line">    <span class="comment">// ex. Date(), Symbol(), function(), etc.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> array !== <span class="string">'object'</span> || !array) <span class="keyword">return</span> array;</span><br><span class="line">    <span class="comment">// if object is array then convert this to string</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'[object Array]'</span> === <span class="built_in">Object</span>.prototype.toString.apply(array)) &#123;</span><br><span class="line">      clone = [];</span><br><span class="line">      <span class="keyword">var</span> len = array.length;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) clone[i] = deepClone(array[i]);</span><br><span class="line">      <span class="keyword">return</span> clone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// handle object (skip if doesn't have property)</span></span><br><span class="line">    clone = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> array) <span class="keyword">if</span> (array.hasOwnProperty(i)) clone[i] = deepClone(array[i]);</span><br><span class="line">    <span class="keyword">return</span> clone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">buildObject().then(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().toISOString().replace(<span class="string">'T'</span>,<span class="string">' '</span>).replace(<span class="string">'Z'</span>,<span class="string">''</span>).substr(<span class="number">0</span>,<span class="number">19</span>));</span><br><span class="line">    <span class="built_in">console</span>.log(array.length+<span class="string">' object has been build'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'======'</span>);</span><br><span class="line">    <span class="keyword">return</span> resolve;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Start clone '</span>+array.length+<span class="string">' object: '</span>+<span class="keyword">new</span> <span class="built_in">Date</span>().toISOString().replace(<span class="string">'T'</span>,<span class="string">' '</span>).replace(<span class="string">'Z'</span>,<span class="string">''</span>).substr(<span class="number">0</span>,<span class="number">19</span>));</span><br><span class="line">    <span class="keyword">var</span> time_start = <span class="built_in">Date</span>.now();</span><br><span class="line">    clone = deepClone(array);</span><br><span class="line">    <span class="keyword">var</span> time_end = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Finish clone '</span>+array.length+<span class="string">' object: '</span>+<span class="keyword">new</span> <span class="built_in">Date</span>().toISOString().replace(<span class="string">'T'</span>,<span class="string">' '</span>).replace(<span class="string">'Z'</span>,<span class="string">''</span>).substr(<span class="number">0</span>,<span class="number">19</span>));</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Total execution time: '</span>+ (time_end-time_start)+<span class="string">'ms'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'======'</span>);</span><br><span class="line">    <span class="keyword">return</span> resolve;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>I know there is another way to deepClone an object in javascript. You could using <code>jQuery</code> or <code>Lodash</code>, but the performance is very bad. I recommend you to using native way.</p>
<p>So this is only small research from me about deep clone object in javascript. The decision is going back to yours.</p>
<p>Thank you.</p>
</div></article></div><div class="right-container"><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">Search</label></div><div class="search-result" id="search_result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a class="next" href="/post/contact/" title="Contact">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_config = function () {this.page.url = window.location.href;this.page.identifier = window.location.href;};
(function() { var d = document, s = d.createElement("script");s.src="https://hexoder.disqus.com/embed.js";s.setAttribute("data-timestamp", +new Date());(d.head || d.body).appendChild(s);})();</script><div class="copyright"><p>© 2019 <a href="/" target="_blank">Hexoder</a> | <a href="/post/about">About</a> | <a href="/post/contact">Contact</a> | <a href="/post/privacy-policy">Privacy</a> | <a href="/atom.xml">Feed</a> | <a href="/sitemap.xml">Sitemap</a></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="/scripts/ar-anchor.min.js"></script><script src="/scripts/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-151912342-1",'auto');ga('send','pageview');</script></body></html>