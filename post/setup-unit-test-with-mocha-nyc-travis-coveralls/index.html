<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Setup Unit Test with Mocha + NYC + Travis and Coveralls · Hexoder</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Setup Unit Test with Mocha + NYC + Travis and Coveralls - M ABD AZIZ ALFIAN"><meta name="keywords" content="learning-javascript, tutorial-javascript, learning-nodejs, tutorial-nodejs, elementary-os, linux"><meta name="author" content="M ABD AZIZ ALFIAN"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/aalfiann/hexoder@gh-pages/css/bubuzou.min.css"><link rel="search" type="application/opensearchdescription+xml" href="https://hexoder.com/atom.xml" title="Hexoder"><script src="//cdn.jsdelivr.net/npm/text-obfuscator@1.0.2/dist/text-obfuscator.min.js"></script><script>function parse_query_string(e){for(var o=e.replace("?","").split("&"),n={},r=0;r<o.length;r++){var t=o[r].split("="),i=decodeURIComponent(t[0]),a=decodeURIComponent(t[1]);if(void 0===n[i])n[i]=decodeURIComponent(a);else if("string"==typeof n[i]){var l=[n[i],decodeURIComponent(a)];n[i]=l}else n[i].push(decodeURIComponent(a))}return n}function removeParam(e,o){var n=o.split("?")[0],r=[],t=-1!==o.indexOf("?")?o.split("?")[1]:"";if(""!==t){for(var i=(r=t.split("&")).length-1;0<=i;i-=1)r[i].split("=")[0]===e&&r.splice(i,1);0<r.length?n=n+"?"+r.join("&"):n+=r.join("&")}return n}var hash=parse_query_string(window.location.search).to;if(hash){var link=TextObfuscator.decode(hash,3),newurl=removeParam("to",window.location.href);newurl=newurl.replace(window.location.origin,""),window.history.replaceState({},document.title,newurl)}</script><script data-ad-client="ca-pub-8811888720849913" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><header><div class="header row"><a class="logo-link" href="/"><img src="//cdn.jsdelivr.net/gh/aalfiann/hexoder@gh-pages/images/logo-landscape.png"></a><ul class="nav nav-list" id="nav_list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self" data-hover="HOME">HOME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/about" target="_self" data-hover="ABOUT">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self" data-hover="ARCHIVES">ARCHIVES</a></li><li class="nav-list-item"><a class="nav-list-link" href="/contact" target="_self" data-hover="CONTACT">CONTACT</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div><div class="nav-btn" id="nav_btn"><span></span><span></span><span></span></div></div></header><div class="row scroll-con"><section class="container"><div id="safelinker1"></div><div class="post" id="postAr"><article class="post-block"><h1 class="post-title">Setup Unit Test with Mocha + NYC + Travis and Coveralls</h1><div class="post-info">2019-11-12</div><div class="post-content"><p><img src="https://i.imgur.com/bjdmclk.png" alt=""></p><p>Unit test is a way to make sure your code is running well before integration into core application. The most popular library to achieve this is <code>Mocha</code>, <code>NYC</code>, <code>Travis-CI</code>, <code>Gitlab-CI</code> and <code>Coveralls</code>.</p><p>This article was updated at <strong>07 Aug 2021</strong>.</p><a id="more"></a><p>If you are working as backend developer, unit test is a must thing to do. So before we going to the main tutorial, firstly we must know about :</p><h2 id="Mocha"><a href="#Mocha" class="headerlink" title="Mocha"></a><a href="https://www.npmjs.com/package/mocha" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">Mocha</a></h2><p>Mocha is the Javascript test framework which is running in NodeJS also in browser.</p><h2 id="NYC"><a href="#NYC" class="headerlink" title="NYC"></a><a href="https://www.npmjs.com/package/nyc" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">NYC</a></h2><p>In the past we knew this as <code>Istanbul</code>, this is a command line interface for unit test.</p><h2 id="Travis-CI"><a href="#Travis-CI" class="headerlink" title="Travis-CI"></a><a href="https://travis-ci.org" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">Travis-CI</a></h2><p>Travis CI is a hosted continuous integration service used to build and test software projects hosted at GitHub. We needed this to make sure our application is <code>build passing</code> or not. You have to register first and don’t worry, Travis is always free for open source projects.</p><h2 id="Gitlab-CI"><a href="#Gitlab-CI" class="headerlink" title="Gitlab-CI"></a><a href="https://gitlab.com" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">Gitlab-CI</a></h2><p>Gitlab CI is a continuous integration service used to build and test software projects by Gitlab. This Gitlab-CI only work if your source code is hosted at Gitlab.com only. If you don’t host at Gitlab, you can skip this and use Travis-CI.</p><h2 id="Coveralls"><a href="#Coveralls" class="headerlink" title="Coveralls"></a><a href="https://coveralls.io" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">Coveralls</a></h2><p>Ensure that all your new code is fully covered, and see coverage trends emerge. You need this to know which line of your code is uncovered or skipped of being test. You have to register first and don’t worry, this free as long as your projects is open source.</p><h2 id="TLDR"><a href="#TLDR" class="headerlink" title="TLDR"></a>TLDR</h2><p>You are able to directly learn from source at <a href="https://github.com/aalfiann/starter-boilerplate" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">here</a>.</p><h2 id="Setup-Tutorial"><a href="#Setup-Tutorial" class="headerlink" title="Setup Tutorial"></a>Setup Tutorial</h2><h3 id="Install-Library"><a href="#Install-Library" class="headerlink" title="Install Library"></a>Install Library</h3><p>Make sure you install this library from NPM.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install mocha mocha-lcov-reporter coveralls nyc --save-dev</span><br></pre></td></tr></table></figure><h3 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a>.gitignore</h3><p>Create or edit your <code>.gitignore</code> file like this</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">coverage</span><br><span class="line">.nyc_output</span><br></pre></td></tr></table></figure><h3 id="travis-yml"><a href="#travis-yml" class="headerlink" title=".travis.yml"></a>.travis.yml</h3><p>Create or edit your <code>.travis.yml</code> file like this</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">node_js</span></span><br><span class="line"><span class="attr">node_js:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">"node"</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">"10"</span></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">global:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">NODE_ENV=development</span></span><br><span class="line"><span class="attr">before_install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">export</span> <span class="string">TZ=Asia/Jakarta</span></span><br><span class="line"><span class="attr">install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line"><span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">npm</span> <span class="string">test</span></span><br><span class="line"><span class="attr">after_success:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">coverage</span></span><br></pre></td></tr></table></figure><p>Travis CI will build and test your source code under NodeJS 10 and Latest version.</p><h3 id="gitlab-ci-yml"><a href="#gitlab-ci-yml" class="headerlink" title=".gitlab-ci.yml"></a>.gitlab-ci.yml</h3><p>Create or edit your <code>.gitlab-ci.yml</code> file like this</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">node10</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">latest</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">node_modules/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">node_10:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">node10</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">node:10</span></span><br><span class="line">  <span class="attr">script:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">coverage</span></span><br><span class="line">  <span class="attr">coverage:</span> <span class="string">/Statements\s+:\s(\d+.?\d+)%/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">node_latest:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">latest</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">node:latest</span></span><br><span class="line">  <span class="attr">script:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">coverage</span></span><br><span class="line">  <span class="attr">coverage:</span> <span class="string">/Statements\s+:\s(\d+.?\d+)%/</span></span><br></pre></td></tr></table></figure><p>Gitlab CI will build and test your source code under NodeJS 10 and Latest version.</p><p><strong>Note:</strong></p><ul><li>If your source code is not hosted at Gitlab, you can skip this and use Travis CI only.</li><li>This configuration also work with <code>Gitlab Self Hosting</code> or <code>Community Version</code>.</li></ul><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>Modify your package json only on the <code>scripts</code> part.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "test": "echo 'NodeJS:' &amp;&amp; npx node -v &amp;&amp; nyc --reporter=html --reporter=text --reporter=text-summary mocha",</span><br><span class="line">    "coverage": "nyc report --reporter=text-lcov | coveralls"</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h3 id="Run-Test"><a href="#Run-Test" class="headerlink" title="Run Test"></a>Run Test</h3><p>You can just run your unit test with use command below</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h3 id="Badge"><a href="#Badge" class="headerlink" title="Badge"></a>Badge</h3><p>To make your project looks more confident and professional, you must put the badge from <code>Travis</code> and <code>Coveralls</code> into your <code>readme.md</code> file like this below</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[![Build Status](https://travis-ci.com/YOUR_USERNAME/YOUR_PROJECT_NAME.svg?branch=master)](https://travis-ci.com/YOUR_USERNAME/YOUR_PROJECT_NAME)</span><br><span class="line">[![Coverage Status](https://coveralls.io/repos/github/YOUR_USERNAME/YOUR_PROJECT_NAME/badge.svg?branch=master)](https://coveralls.io/github/YOUR_USERNAME/YOUR_PROJECT_NAME?branch=master)</span><br></pre></td></tr></table></figure><p>If you are using Gitlab CI, badge are available by Gitlab and you don’t have to put manually into your <code>readme.md</code> file.<br>To add this badge to your project:</p><ul><li>Navigate to your project’s <code>Settings &gt; General &gt; Badges</code>.</li><li>Under <code>Name</code>, enter <code>Pipeline Status</code>.</li><li>Under <code>Link</code>, enter the following URL: <code>https://gitlab.com/%{project_path}/-/commits/%{default_branch}</code></li><li>Under <code>Badge image URL</code>, enter the following URL: <code>https://gitlab.com/%{project_path}/badges/%{default_branch}/pipeline.svg</code></li><li>Submit the badge by clicking the <code>Add badge button</code>.</li></ul><p>If you want to add <code>Coverage Badge</code> in Gitlab CI, everything is the same as above but,<br>Under <code>Badge image URL</code>, enter the following URL: <code>https://gitlab.com/%{project_path}/badges/%{default_branch}/coverage.svg</code>.</p><h2 id="Code-Standard-or-Code-Style"><a href="#Code-Standard-or-Code-Style" class="headerlink" title="Code Standard or Code Style"></a>Code Standard or Code Style</h2><p>Sometimes if you want to go for open source, you have to use code standard to make easier maintainer and contributor to improve your project. The most popular code standard for NodeJS is <a href="https://standardjs.com/" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">JSStandard</a>, because it very easy to use.</p><p>So how to implement this? Follow this tutorial below.</p><h3 id="Install-JS-Standard"><a href="#Install-JS-Standard" class="headerlink" title="Install JS Standard"></a>Install JS Standard</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install standard</span><br></pre></td></tr></table></figure><h3 id="package-json-1"><a href="#package-json-1" class="headerlink" title="package.json"></a>package.json</h3><p>Modify your package json only on the <code>scripts</code> part. Just add the <code>standard</code> into <code>test</code> part like this below.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "test": "echo 'NodeJS:' &amp;&amp; npx node -v &amp;&amp; standard &amp;&amp; nyc --reporter=html --reporter=text --reporter=text-summary mocha",</span><br><span class="line">    "coverage": "nyc report --reporter=text-lcov | coveralls"</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>Done, now your project is better, having code standard and far from bug.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article I just tell you how to setup unit test only. So actualy you have to create your unit test first by your self.</p><p>If you need the source code of this example, just download at <a href="https://github.com/aalfiann/starter-boilerplate" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">my github here</a>. Actualy, I use this for almost my open source library at <a href="https://npmjs.com/~aalfiann" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">NPM</a>.</p><p>In the next article, I will write tutorial create simple app with unit test. So don’t forget to bookmark this website. I will always happy to share my knowledge for all of you guys.</p><p>Thank You.</p></div></article></div><div id="safelinker2"></div><div id="adscustom"><div><iframe src="https://imgfo.com/featured-box-embed.html" width="300px" height="250px" frameborder="0" scrolling="no" style="max-width:300px!important"></iframe></div><div><iframe src="https://imgfo.com/featured-box-embed.html" width="300px" height="250px" frameborder="0" scrolling="no" style="max-width:300px!important"></iframe></div></div><div class="right-container"><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">Search</label></div><div class="search-result" id="search_result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a class="prev" href="/post/install-wine-4-on-elementary-os-juno/" title="Install Wine 4 on Elementary OS Juno">PREV</a><a class="next" href="/post/right-way-to-deep-clone-object-javascript/" title="Right Way to Deep Clone Object JavaScript">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url=window.location.href,this.page.identifier=window.location.href};!function(){var e=document,t=e.createElement("script");t.src="https://hexoder.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script><div class="copyright"><p>© 2019 - 2021 <a href="/" target="_blank">Hexoder</a> | <a href="/disclaimer">Disclaimer</a> | <a href="/privacy-policy">Privacy</a> | <a href="/atom.xml">Feed</a> | <a href="/sitemap.xml">Sitemap</a></p><br><a class="dmca-badge" href="//www.dmca.com/Protection/Status.aspx?ID=eb23d7cc-74cc-4a2f-8e4d-d4676a061313" title="DMCA.com Protection Status"><img src="https://images.dmca.com/Badges/dmca_protected_sml_120m.png?ID=eb23d7cc-74cc-4a2f-8e4d-d4676a061313" alt="DMCA.com Protection Status"></a><script src="https://images.dmca.com/Badges/DMCABadgeHelper.min.js"></script></div><div class="totop"><i></i></div></div></footer><script src="//cdn.jsdelivr.net/gh/aalfiann/hexoder@gh-pages/scripts/jquery-1.8.2.min.js"></script><script src="//cdn.jsdelivr.net/gh/aalfiann/hexoder@gh-pages/scripts/ar-anchor.min.js"></script><script src="//cdn.jsdelivr.net/gh/aalfiann/hexoder@gh-pages/scripts/main.js"></script><script src="//cdn.jsdelivr.net/npm/safelink-jquery@1.1.0/src/safelink.min.js"></script><script>$("#safelinker1").Safelink({encoded:link,timer:!0,firstButtonText:"Click Here First >>",secondButtonText:"Continue to Get Link >>"}).build("#safelinker2","btn-safelink btn-hoverable")</script><script>!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga||(e.ga=function(){(e.ga.q=e.ga.q||[]).push(arguments)}),e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-151912342-1","auto"),ga("send","pageview")</script></body></html>